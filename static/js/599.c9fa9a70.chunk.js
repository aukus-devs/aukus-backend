"use strict";(self.webpackChunkaukus_frontend=self.webpackChunkaukus_frontend||[]).push([[599],{3599:(e,t,i)=>{i.r(t),i.d(t,{default:()=>g});var o,s,n,l,a,h,d=i(7580),r=(i(2916),Object.defineProperty),c=(e,t,i)=>(((e,t,i)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),u=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},p=(e,t,i)=>(u(e,t,"read from private field"),i?i.call(e):t.get(e)),v=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},f=(e,t,i,o)=>(u(e,t,"write to private field"),o?o.call(e,i):t.set(e,i),i),m=(e,t,i,o)=>({set _(o){f(e,t,o,i)},get _(){return p(e,t,o)}});class g{constructor(e){c(this,"config"),v(this,o,void 0),c(this,"initialized",!1),v(this,s,{}),v(this,n,0),v(this,l,0),v(this,a,[]),v(this,h,void 0),c(this,"noop",(()=>{})),this.onInitComplete=e.onInitComplete||this.noop,this.onThemeLoaded=e.onThemeLoaded||this.noop,this.onRollResult=e.onRollResult||this.noop,this.onRollComplete=e.onRollComplete||this.noop,this.onDieRemoved=e.onDieRemoved||this.noop,this.initialized=this.initScene(e)}async initScene(e){this.config=e.options,this.onInitComplete()}resize(){}loadTheme(){return Promise.resolve()}updateConfig(e){Object.assign(this.config,e)}addNonDie(e){console.log("die",e),clearTimeout(p(this,h));const{id:t,value:i,...o}=e,l={id:t,value:i,config:o};p(this,s)[t]=l,p(this,a).push(setTimeout((()=>{this.handleAsleep(l)}),m(this,n)._++*this.config.delay)),f(this,h,setTimeout((()=>{this.onRollComplete()}),500))}add(e){console.log("add die"),this.addNonDie(e)}remove(e){console.log("remove die");const t=p(this,s)[e.id];t.hasOwnProperty("d10Instance")&&(delete p(this,s)[t.d10Instance.id],m(this,l)._--),delete p(this,s)[e.id],m(this,l)._--,this.onDieRemoved(e.rollId)}clear(){!Object.keys(p(this,s)).length&&!p(this,l)||(p(this,a).forEach((e=>clearTimeout(e))),Object.values(p(this,s)).forEach((e=>{e.mesh&&e.mesh.dispose()})),f(this,s,{}),f(this,n,0),f(this,l,0))}async handleAsleep(e){var t,i;if(e.asleep=!0,await d.D.getRollResult(e),e.d10Instance||e.dieParent){if(null!=(t=null==e?void 0:e.d10Instance)&&t.asleep||null!=(i=null==e?void 0:e.dieParent)&&i.asleep){const t=100===e.config.sides?e:e.dieParent,i=10===e.config.sides?e:e.d10Instance;0===i.value&&0===t.value?t.value=100:t.value=t.value+i.value,this.onRollResult({rollId:t.config.rollId,value:t.value})}}else 10===e.config.sides&&0===e.value&&(e.value=10),this.onRollResult({rollId:e.config.rollId,value:e.value});m(this,l)._++}}o=new WeakMap,s=new WeakMap,n=new WeakMap,l=new WeakMap,a=new WeakMap,h=new WeakMap}}]);
//# sourceMappingURL=599.c9fa9a70.chunk.js.map